# 註冊

## 概述

本文檔旨在為第三方系統提供使用者註冊功能的接入說明。透過本接口，第三方系統可以引導使用者完成註冊流程。

## 頁面說明

### 請求方式

以連結形式開放，使用者點擊連結後將跳轉到註冊頁面。

### 頁面地址

```
https://www.equalearning.net/auth/register
```

## 參數說明

所有參數都需要進行 URL 編碼後傳遞。

| 參數名稱 | 類型 | 是否必填 | 說明 |
|---------|------|---------|------|
| firstName | String | 是 | 使用者的名 |
| lastName | String | 是 | 使用者的姓 |
| email | String | 是 | 郵件地址，可用作使用者名稱 |
| code | String | 是 | 班級邀請碼 |
| payload | String | 否 | 需要傳遞並保存的資料，以 JSON 格式傳遞 |

### payload 參數詳細說明

`payload` 參數用於傳遞額外的使用者資訊，這些資訊將被保存在使用者檔案（userProfiles）中。

**格式要求：**
- 必須是有效的 JSON 格式字串
- 需要進行 URL 編碼
- 支援傳遞多個鍵值對

**範例：**

原始 JSON 資料：
```json
{
  "tenantId": "1",
  "userId": "1"
}
```

URL 編碼後：
```
%7B%22tenantId%22%3A%221%22%2C%22userId%22%3A%221%22%7D
```

## 完整範例

### 範例連結

```
https://www.equalearning.net/auth/register?firstName=Ge&lastName=Anthony&email=uncomfortablehenrie%40tiffincrane.com&code=WE2383&payload=%7B%22tenantId%22%3A%221%22%2C%22userId%22%3A%221%22%7D
```

### 參數解析

| 參數 | 原始值 | 編碼後的值 |
|-----|--------|-----------|
| firstName | Ge | Ge |
| lastName | Anthony | Anthony |
| email | uncomfortablehenrie@tiffincrane.com | uncomfortablehenrie%40tiffincrane.com |
| code | WE2383 | WE2383 |
| payload | {"tenantId":"1","userId":"1"} | %7B%22tenantId%22%3A%221%22%2C%22userId%22%3A%221%22%7D |

## 註冊流程

1. 使用者點擊第三方系統提供的註冊連結
2. 系統自動填充 firstName、lastName、email 等資訊
3. 根據 code（班級邀請碼）獲取對應的學校資訊
4. 使用者輸入密碼並完成註冊
5. 如果有 payload 參數，系統會將其中的資料保存到使用者檔案中
6. 註冊成功後，郵箱地址將被標記為已驗證狀態（emailConfirmed = true）
7. 系統不會發送驗證郵件（needSendConfirmEmail = false）

## 注意事項

1. **參數編碼**：所有參數值都必須進行 URL 編碼，特別是包含特殊字符的參數（如 email 中的 `@` 符號，payload 中的 JSON 字串）
2. **邀請碼有效性**：確保 code 參數是有效的班級邀請碼，否則註冊將失敗
3. **郵箱唯一性**：每個郵箱地址在同一學校內只能註冊一次
4. **欄位限制**：透過此接口註冊時，firstName、lastName、email 欄位將被鎖定無法修改
5. **自動驗證**：透過此接口註冊的使用者，郵箱將自動被標記為已驗證，無需再進行郵箱驗證

## 技術實現說明

### URL 編碼

在不同的程式語言中，可以使用以下方法進行 URL 編碼：

**JavaScript:**
```javascript
encodeURIComponent("uncomfortablehenrie@tiffincrane.com")
// 結果: uncomfortablehenrie%40tiffincrane.com

var payload = JSON.stringify({tenantId: "1", userId: "1"});
encodeURIComponent(payload)
// 結果: %7B%22tenantId%22%3A%221%22%2C%22userId%22%3A%221%22%7D
```

**Python:**
```python
from urllib.parse import quote

quote("uncomfortablehenrie@tiffincrane.com")
# 結果: uncomfortablehenrie%40tiffincrane.com

import json
payload = json.dumps({"tenantId": "1", "userId": "1"})
quote(payload)
# 結果: %7B%22tenantId%22%3A%20%221%22%2C%20%22userId%22%3A%20%221%22%7D
```

**C#:**
```csharp
System.Web.HttpUtility.UrlEncode("uncomfortablehenrie@tiffincrane.com")
// 結果: uncomfortablehenrie%40tiffincrane.com

var payload = JsonConvert.SerializeObject(new { tenantId = "1", userId = "1" });
System.Web.HttpUtility.UrlEncode(payload)
// 結果: %7B%22tenantId%22%3A%221%22%2C%22userId%22%3A%221%22%7D
```

## 錯誤處理

如果註冊過程中發生錯誤，系統會在頁面上顯示相應的錯誤訊息，常見錯誤包括：

- 邀請碼無效
- 郵箱已被註冊
- 必填欄位為空
- 郵箱格式不正確

## 聯絡方式

如有任何疑問或需要技術支援，請聯絡系統管理員。

